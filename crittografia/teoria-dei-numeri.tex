\chapter{Teoria dei numeri}
\section{Proprietà dei numeri}

La teoria dei numeri è una branca fondamentale della matematica che studia le proprietà degli interi e delle loro relazioni. Nel contesto della teoria dei numeri, diversi concetti chiave emergono dall'analisi delle operazioni e degli insiemi numerici.

\begin{tcolorbox}[title={Operazioni chiuse}]
Un'operazione si dice chiusa se l'operazione applicata a due numeri naturali restituisce un numero naturale.
\[
  \mathbb{N} \, \texttt{op} \, \mathbb{N} \to \mathbb{N}  
\]
Ad esempio, l'addizione e la moltiplicazione sono operazioni chiuse sugli interi.
\end{tcolorbox}

Quando un'operazione non è chiusa? La divisione, non produce sempre un numero naturale. Gli insiemi sono inoltre caratterizzati da proprietà che li rendono unici.

\begin{tcolorbox}[title={Proprietà commutativa}]
  \[
    a \, \texttt{op} \, b = b \, \texttt{op} \, a
  \]
L'addizione e la moltiplicazione sono esempi di operazioni che soddisfano la proprietà commutativa.
\end{tcolorbox}

\begin{tcolorbox}[title={Proprietà associativa}]
  \[
    \forall a, b, c \in A \qquad a \, \texttt{op} \, (b \, \texttt{op} \, c) = (a \, \texttt{op} \, b) \, \texttt{op} \, c
  \]
La proprietà associativa è verificata dall'addizione e dalla moltiplicazione su diversi insiemi numerici.
\end{tcolorbox}

\begin{tcolorbox}[title={Elemento neutro}]
  \[
    a \, \texttt{op} \, e = a
  \]
  quindi 
  \[
    \exists e \in A \texttt{ t.c. }\forall a \in A \, a \, \texttt{op} \, e = e \, \texttt{op} \, a = a
  \]
L'elemento neutro per l'addizione è lo zero, mentre per la moltiplicazione è l'unità.
\end{tcolorbox}

\begin{tcolorbox}[title={Elemento inverso}]
  \[
    \forall a \in A \, \exists a^{-1} \in A \texttt{ t.c. } a \, \texttt{op} \, a^{-1} = a^{-1} \, \texttt{op} \, a = e
  \]
Alcuni esempi di elementi inversi includono l'opposto di un numero per l'addizione e il reciproco di un numero non nullo per la moltiplicazione.
\end{tcolorbox}

Ogni volta che definiamo delle strutture matematiche che soddisfano tali proprietà, si parla di gruppi. Un \textbf{gruppo} è
una struttura algebrica che rispetta determinate regole, tra cui chiusura, associatività, presenza di un elemento neutro e di un elemento inverso.

Prendiamo in considerazione i numeri naturali rispetto all'operazione di somma. Hanno l'inverso? No, quindi non è un gruppo. Tuttavia,
se aggiungessimo altri elementi e arrivassimo ai numeri interi, allora avremmo un gruppo rispetto alla somma. Allo stesso modo, se
considerassimo i numeri interi rispetto alla moltiplicazione (\textit{senza lo zero}), non avremmo l'inverso. In questo caso, dovremmo aggiungere
gli inversi e arrivare ai numeri razionali, che costituiscono un gruppo rispetto alla moltiplicazione.

Capita spesso di avere strutture che non sono gruppi. In questi casi, si possono seguire due approcci: ridurre la struttura eliminando
gli elementi che non soddisfano le proprietà del gruppo o espandere la struttura aggiungendo elementi in modo da soddisfare tali proprietà.

Vorremmo lavorare su un'algebra diversa, possibilmente con gruppi finiti. In particolare, ci concentreremo su gruppi che costituiscono
l'algebra alla base dei nostri algoritmi crittografici. Utilizzeremo funzioni che sono facili da calcolare ma difficili da invertire,
comunemente conosciute come \textbf{one-way function}. Queste funzioni si basano sull'algebra moltiplicativa.

Successivamente, esamineremo anche la crittografia ellittica, che si basa su un'algebra diversa, operando su curve ellittiche. Tuttavia,
gli algoritmi fondamentali rimarranno gli stessi, utilizzando però un'algebra additiva.

\section{Classe di equivalenza $\mathbb{Z}_n$}
Possiamo dire che:
\[
  \mathbb{Z}_n \equiv \mathbb{Z}_n \qquad a \equiv b \pmod{n} \iff (a \mod n) = (b \mod n)
\]
Quindi due numeri sono equivalenti se hanno lo stesso resto nella divisione per $n$.
Ad esempio, $5 \equiv 11 \pmod{3}$, perché entrambi hanno resto 2 nella divisione per 3.

Quando abbiamo una relazione di equivalenza possiamo costruire l'insieme degli oggetti equivalenti tra loro. 
L'insieme degli insiemi di oggetti equivalenti forma una \textbf{partizione}, gli elementi di tale 
partizione sono detti \textbf{classi di equivalenza} e si denotano mediante parentesi quadre di un elemento di tale classe.
Ogni singola classe di equivalenza può essere rappresentata da un qualsiasi elemento della classe stessa. 
\[
  \mathbb{Z}_n = \{0,1,2,3,\dots, n-1\}
\]

Un'analogia può essere fatta con le ore. Se sono le 10:00, allora sono anche le 22:00,
perché entrambe sono equivalenti a 10:00 $\pmod{12}$, o con le frazioni. È l'insieme 
delle classi di equivalenza tra numeri naturali dove due coppie sono 
equivalenti se hanno lo stesso prodotto incrociato, quindi il prodotto 
dei medi è uguale al prodotto degli estremi. Ad esempio, $2 \times 3 = 1 \times 6$. 
\[
  \frac{1}{2} \equiv \frac{3}{6}
\]
La rappresentazione canonica di una classe di equivalenza in $\mathbb{Z}_n$ è il suo
rappresentante minimo, ovvero un numero naturale compreso tra 0 e $n-1$.

Su tale insieme voglio definire delle operazioni.
\subsection{Somma}
La somma di due classi di equivalenza è definita come la classe di
equivalenza della somma dei rappresentanti. Ad esempio, se voglio
calcolare $[2] + [3]$, allora calcolo $2 + 3 = 5$ e la classe di equivalenza
di 5 è $[5]$. In generale, la somma di due classi di equivalenza è la classe
di equivalenza della somma dei rappresentanti.
\[
  [a] + [b] \stackrel{\Delta}{=} [a + b]
\]
Tale rappresentazione è buona solo se il risultato è indipendente dagli elementi 
delle due classi originali.
\subsubsection{Proprietà}
\begin{itemize}
  \item \textbf{Commutativa}: $\forall a, b \,[a] + [b] = [b] + [a]$.
  \item \textbf{Associativa}: $\forall a, b, c \,[a] + ([b] + [c]) = ([a] + [b]) + [c]$.
  \item \textbf{Elemento neutro}: $\exists e \in \mathbb{Z}_n \, \forall a \, [a] + [a] = [a] + [a] = [a]\qquad e = 0$.
  \item \textbf{Elemento inverso}: $\forall a \, \exists a^{-1} \in \mathbb{Z}_n \,
  \text{t.c.} \, [a] + [a^{-1}] = [a^{-1}] + [a] = [e] \qquad a^{-1} = -a$.
\end{itemize}
L'insieme $\mathbb{Z}_n$ con l'operazione di somma forma un \textbf{gruppo abeliano}, 
(\textit{abeliano} perché commutativo).
\subsection{Moltiplicazione}
La moltiplicazione di due classi di equivalenza è definita come la classe di
equivalenza del prodotto dei rappresentanti. Ad esempio, se voglio
calcolare $[2] \cdot [3]$, allora calcolo $2 \cdot 3 = 6$ e la classe di equivalenza
di 6 è $[6]$. In generale, la moltiplicazione di due classi di equivalenza è la classe
di equivalenza del prodotto dei rappresentanti.
\[
  [a] \cdot [b] \stackrel{\Delta}{=} [a \cdot b]
\]
Tale rappresentazione è buona solo se il risultato è indipendente dagli elementi
delle due classi originali.
\subsubsection{Proprietà}
\begin{itemize}
  \item \textbf{Commutativa}: $\forall a, b \,[a] \cdot [b] = [b] \cdot [a]$.
  \item \textbf{Associativa}: $\forall a, b, c \,[a] \cdot ([b] \cdot [c]) = ([a] \cdot [b]) \cdot [c]$.
  \item \textbf{Elemento neutro}: $\exists e \in \mathbb{Z}_n \, \forall a \, [a] \cdot [a] = [a] \cdot [a] = [a]\qquad e = 1$.
\end{itemize}
L'insieme $\mathbb{Z}_n$ con l'operazione di moltiplicazione forma un \textbf{semigruppo}, 
ovvero un gruppo senza l'elemento inverso.
Per ottenere un gruppo, devo aggiungere l'elemento inverso. Per ottenere tale elemento,
quindi passare da un semigruppo ad un gruppo, 
posso seguire diverse strade; arricchire l'insieme con nuovi elementi, oppure
eliminare elementi.

Consideriamo l'insieme $\mathbb{Z}_n - \{0\}$ con l'operazione di moltiplicazione e consideriamo 
un esempio con $n = 15$.
\[
  \mathbb{Z}_{15} - \{0\} = \{1,2,3,4,5,6,7,8,9,10,11,12,13,14\}
\]
\begin{itemize}
  \item L'inverso moltiplicativo di $1$ è $1$.
  \item L'inverso moltiplicativo di $2$ è $8$ ($2 \cdot 8 = 16 \equiv 1 \pmod{15}$).
  \item L'inverso moltiplicativo di $3$ non c'è.
  \item \dots
\end{itemize}
Notiamo che non tutti gli elementi hanno un inverso moltiplicativo, quindi non 
posso costruire un gruppo. Per ottenere un gruppo, devo eliminare gli elementi
che non hanno un inverso moltiplicativo.
L'insieme $\mathbb{Z}_{15} - \{0, 3, 5, 6, 9, 10, 12\}$ che sarà quindi:
\[
  \mathbb{Z}_{15}^* = \{1,2,4,7,8,11,13,14\}
\]
Abbiamo quindi definito l'insieme $\mathbb{Z}_n^*$:
\[
  \mathbb{Z}_n^* = \{a \in \mathbb{Z}_n \, | \, \texttt{mcd}(a, n) = 1\}
\]
Ovvero l'insieme dei numeri che sono relativi primi con $n$.
Moltiplicando due numeri relativamente primi con $n$, ottengo un numero
relativamente primo con $n$. L'operazione di moltiplicazione è chiusa in $\mathbb{Z}_n^*$.
\begin{theorem}[Teorema di Eulero]
  Per ogni $a, b \, \exists x,y \, ax + by = \texttt{mcd}(a,b)$
\end{theorem}
Se $a \in \mathbb{Z}_n^*$ allora $\texttt{mcd}(a, n) = 1$ per definizione e quindi
\[
  ax + ny = 1
\] 
\[
  ax = 1 - ny
\]
\[
  ax \equiv 1 \pmod{n}
\]
Quindi la classe di equivalenza di $x$ è l'inverso moltiplicativo di $a$.
La necessità di lavorare con gruppi nasce dal fatto che in informatica
è necessario lavorare con insiemi finiti, in questo caso algebre su insiemi 
finiti, in particolare sui gruppi, in modo da manipolare gli elementi in 
base alle proprietà.
\section{Gruppi e generatori}
Sia $\mathcal{G}$ un gruppo, un operatore $\otimes$. Sia $g$ un elemento di $\mathcal{G}$.
\[
  g = g^1 \qquad g \otimes g = g^2 \qquad g \otimes g \otimes g = g^3 \qquad \dots \qquad g \otimes g 
  \otimes g \otimes \dots \otimes g = g^n
\]
Continuando a moltiplicare $g$ per se stesso, non arriverò ad un qualsiasi $n$ generico, poiché 
il gruppo è finito. Quindi, supponiamo  che arrivi a $g \otimes g 
\otimes g \otimes \dots \otimes g = g^{\lvert \mathcal{G} \rvert}$ e che l'esponente successivo 
sia $g^{\lvert \mathcal{G} \rvert + 1}$. Per il \textbf{pumping lemma} avrò sicuramente 
almeno un elemento ripetuto.
\begin{theorem}
  Per ogni gruppo $\mathcal{G}$ finito, per ogni $a \in \mathcal{G}$,
  \[
    a^{\lvert \mathcal{G} \rvert} = 1
  \]
\end{theorem}
Da questo teorema segue che se sicuramente $a^{\lvert \mathcal{G} \rvert} = 1$ ovvero l'elemento neutro,
ma per un gruppo $\mathcal{G}$ finito, potrei avere anche che per un qualche
$a^i = 1$.

Se prendo tutte le potenze di $g$ ottengo un sottogruppo dell'insieme $\mathcal{G}$, un sottogruppo 
continua ad essere un gruppo. Se quello che ottengo è un sottogruppo proprio, ovvero 
un sottogruppo che è tutto l'insieme $\mathcal{G}$, allora $G$ è ciclico e $g$ è un 
\textbf{generatore} di $\mathcal{G}$.
\begin{theorem}
  Sia $\mathcal{G}'$ un sottogruppo di $\mathcal{G}$, se $|\mathcal{G}'| = |\mathcal{G}|$
  allora $\mathcal{G}'$ è un sottogruppo proprio.
\end{theorem}
\subsubsection{Esempio}
\[
  \mathbb{Z}_{15}^* = \{1,2,4,7,8,11,13,14\}
\]
\begin{itemize}
  \item $1$
  \item $2 \cdot 2 = 4 \cdot 2 = 8 \cdot 2 = 16$ quindi $2^4 \equiv 1 \pmod{15}$
  \item $4 \cdot 4 = 16 \equiv 1 \pmod{15}$
  \item $7 \cdot 7 = 49 \equiv 4, 4 \cdot 7 = 28 \equiv 13, 13 \cdot 7 = 91 \equiv 1 \pmod{15}$
  \item $8 \cdot 8 = 64 \equiv 4, 4 \cdot 8 = 32 \equiv 2, 2 \cdot 8 = 16 \equiv 1 \pmod{15}$
  \item $11 \cdot 11 = 121 \equiv 1 \pmod{15}$
  \item $13 \cdot 13 = 169 \equiv 4, 4 \cdot 13 = 52 \equiv 7, 7 \cdot 13 = 91 \equiv 1 \pmod{15}$
  \item $14 \cdot 14 = 196 \equiv 1 \pmod{15}$
\end{itemize}
La cardinalità di $\mathbb{Z}_{15}^*$ è $8$, ma questo gruppo non è ciclico, poiché non esiste un
elemento generatore che generi tutto il gruppo.
\subsection{Generatori primi}
Se prendo $\mathbb{Z}_{n}^*$ con $n$ primo, allora $\mathbb{Z}_{n}^*$ è ciclico, poiché
ogni elemento di $\mathbb{Z}_{n}^*$ è un generatore di $\mathbb{Z}_{n}^*$.
In generale un numero primo non può essere scomposto in fattori, quindi:
\[
  \mathbb{Z}_{p}^* = \{1,2,3,\dots,p-1\}
\]
\subsubsection{Esempio}
\[
  \mathbb{Z}_{7}^* = \{1,2,3,4,5,6\}
\]
\begin{itemize}
  \item $1$
  \item $2 \cdot 2 = 4 \cdot 2 = 8 \equiv 1 \pmod{7}$
  \item $3 \cdot 3 = 9 \equiv 2, 2 \cdot 3 = 6, 6 \cdot 3 = 18 \equiv 4, 4 \cdot 3 = 12 \equiv 5, 5 \cdot 3 = 15 \equiv 1 \pmod{7}$
  \item $4 \cdot 4 = 16 \equiv 2, 2 \cdot 4 = 8 \equiv 1 \pmod{7}$
  \item $5 \cdot 5 = 25 \equiv 4, 4 \cdot 5 = 20 \equiv 6, 6 \cdot 5 = 30 \equiv 2, 2 \cdot 5 = 10 \equiv 3, 3 \cdot 5 = 15 \equiv 1 \pmod{7}$
  \item $6 \cdot 6 = 36 \equiv 1 \pmod{7}$
\end{itemize}
Abbiamo che $\mathbb{Z}_{7}^*$ è ciclico, poiché esiste un generatore che genera tutto il gruppo, in questo 
caso $3$ e $5$.

\subsection{Probabilità dei numeri primi}
\begin{theorem}[Densità dei numeri primi]
  La densità dei numeri primi è proporzionale al numero di bit che compongono il numero.
\end{theorem}
Suppongo di avere un numero casuale $n$ di $k$ bit, allora la probabilità che $n$ sia primo è 
$\frac{1}{k}$. Supponiamo di voler comporre un numero $n$ di $k$ bit, utilizzo un algoritmo
che mi generi tale numero. 

Per verificare che tale numero sia primo, utilizzo una algoritmo casuale 
che sceglie casualmente un numero $a$ tra $1$ e $n-1$ e verifica che il numero 
scelto sia primo. Statisticamente circa la metà dei numeri scelti sono testimoni del fatto 
che un numero non sia primo. Se il test fallisce e mi dice che il numero non è primo, allora
termino. Se il test ha esito positivo allora scelgo un altro numero $a$ e ripeto il test di 
primalità.
Se tutte le volte che scelgo un numero $a$ il test ha esito positivo, allora la probabilità 
di accettare la primalità di $n$ è $\frac{1}{2^t}$, dove $t$ è il numero di volte che ho
ripetuto il test (\textit{eventi indipendenti}), abbassando la probabilità di errore notevolmente.

Sulla base di questo ragionamento, siamo in grado di generare numeri primi molto grandi.
\section{Logaritmo discreto}
Supponiamo di avere a disposizione un gruppo $\mathbb{Z}_p^*$ un generatore $g$ e un 
elemento di tale gruppo $a \in \mathbb{Z}_p^*$, visto che le potenze del generatore enumerano 
l'intero gruppo, ci sarà una potenza $x$ che mi permette di ottenere $a$:
\[
  g^x = a = g^{x+k(p-1)}
\]
L'oggetto $x$ è detto \textbf{logaritmo discreto} di $a$ in base $g$.
Trovare il logaritmo discreto di un numero è un problema difficile, non possiamo dire che non esistano 
algoritmi efficienti, ma non ne conosciamo nessuno.
Visto che non conosciamo algoritmi efficienti, possiamo utilizzare il logaritmo discreto come
funzione di \textit{one-way}. Al crescere della dimensione del gruppo, il problema diventa
sempre più difficile, in maniera più che polinomiale.

\section{Numero quadrato}
Se ho un gruppo $\mathcal{G}$ con un'operazione binaria $\otimes$, un elemento $a \in \mathcal{G}$
è detto \textbf{quadrato} se e solo se esiste un $x \in \mathcal{G}$ tale che:
\[
  x \otimes x = a
\]
Quindi esiste una radice quadrata di $a$ in $\mathcal{G}$.
Gli elementi in $\mathbb{Z}_p^*$ sono $p-1$, ma solo la metà di questi sono quadrati $\frac{p-1}{2}$.
Perché un numero sia un quadrato devo trovare un numero del gruppo 
che elevato al quadrato mi dia il numero dell'insieme, il numero risultante sarà un quadrato.
\subsubsection{Esempio}
\[
  \mathbb{Z}_7^* = \{1,2,3,4,5,6\}
\]
\begin{itemize}
  \item $1 \cdot 1 = 1$ quindi $1$ è un quadrato;
  \item $2 \cdot 2 = 4$ quindi $4$ è un quadrato;
  \item $3 \cdot 3 = 9 \equiv 2$ quindi $2$ è un quadrato;
  \item $4 \cdot 4 = 16 \equiv 2$ quindi $2$ è un quadrato;
  \item $5 \cdot 5 = 25 \equiv 4$ quindi $4$ è un quadrato;
  \item $6 \cdot 6 = 36 \equiv 1$ quindi $1$ è un quadrato;
\end{itemize}
Gli elementi che non sono quadrati sono quindi $\{3,5,6\}$. Quindi esattamente la metà
degli elementi del gruppo sono quadrati. 
\begin{theorem}
  Tutti e soli gli elementi $g^{2i}$ sono quadrati in $\mathbb{Z}_p^*$.
\end{theorem}
Se consideriamo un generatore $g$ di $\mathbb{Z}_p^*$ e generiamo l'intero gruppo,
è chiaro che tutti gli elementi che sono potenze pari di $g$ sono quadrati.
Di conseguenza tutti gli elementi che sono potenze dispari di $g$ non sono quadrati.

L'elemento $g^{2i}$ ha due radici quadrate, $g^{2i}$ e $g^{2i + \frac{p-1}{2}}$.
\[
  g^{2i} =
\begin{cases}
  g^{2i} \\
  g^{2i + \frac{p-1}{2}} 
\end{cases}
\]
Infatti
\[
  \left( g^{i + \frac{p-1}{2}}\right) = g^{2i}\cdot g^{p-1} = g^{2i} \cdot 1 = g^{2i}
\]
So che le radici quadrate sono anche 
\[
g^{2i} = 
\begin{cases}
  g^{i} \\
  g^{-i}
\end{cases}
\]
Quindi elevare un generatore alla cardinalità del gruppo mi dà $1$, ma 
elevarlo alla metà della cardinalità del gruppo mi dà $-1$.

Con questa osservazione possiamo costruire un algoritmo che mi permette di
distinguere gli elementi che sono quadrati da quelli che non lo sono.
Se conosciamo il logaritmo discreto di un numero $a$ in base $g$. Il fatto 
che non siamo in grado di calcolare il logaritmo discreto in maniera efficiente
non preclude la possibilità che esistano altri algoritmi. 

\section{Simbolo di Legendre}
Il simbolo di Legendre
\[
  \left(\frac{a}{p}\right) \stackrel{\Delta}{=}
  a^{\frac{p-1}{a}} \pmod p
\]
Sia $a = g^{2i}$ ovvero un quadrato, allora
\[
  a^{\frac{p-1}{2}}= (g^{2i})^{\frac{p-1}{2}} = (g^{i})^{p-1} = 
  1^{p-1} = 1 \pmod p
\]
Sia $a = g^{2i + 1}$ ovvero un non quadrato, allora
\[
  a^{\frac{p-1}{2}}= (g^{2i + 1})^{\frac{p-1}{2}} = (g^{2i})^{\frac{p-1}{2}}
  \cdot g^{\frac{p-1}{2}} = (g^{i})^{p-1} \cdot g^{\frac{p-1}{2}} = 
  1 \cdot (-1) = -1 \pmod p
\]
Quindi applicando il simbolo di Legendre ad un numero $a$ in base $g$ otteniamo
\[
  \left(\frac{a}{p}\right) = 
  \begin{cases}
    1 & \text{se $a$ è un quadrato} \\
    -1 & \text{se $a$ non è un quadrato}
  \end{cases}
\]
Quindi il simbolo di Legendre mi permette di distinguere gli elementi che sono
quadrati da quelli che non lo sono.

Sappiamo che nessuno conosce algoritmi efficienti per calcolare il
logaritmo discreto, so però dire che un numero è un quadrato o meno osservando 
l'ultimo bit del numero.

Con il simbolo di Legendre posso calcolare il bit meno significativo di un numero
in maniera efficiente, nonostante non siamo capaci di calcolare il logaritmo 
discreto.

Il fatto che non siamo capaci di calcolare invertire una funzione non implica che 
non siamo capaci di calcolare qualche bit della funzione. Il nostro obiettivo 
però è quello di non ricavare informazioni da nulla, neanche un bit.
Quindi l'elevamento a potenza in $\mathbb{Z}_p^*$ non 
potrà essere usato per codificare.
\subsection{Iterative Squaring}
Il simbolo di Legende possiamo calcolarle in maniera polinomiale, ma 
non in maniera efficiente.
Se eleviamo un numero $a$ per $b$ non operiamo con un algoritmo efficiente.
In  $\mathbb{Z}_p^*$ è possibile calcolare in tempo polinomiale
un'esponenziazione $a^b$ con $a,b \in \mathbb{Z}_p^*$.

Rappresentiamo $b$ in base $2$:
\[
  b = \sum_{i=0}^k b_i \cdot 2^i
\]
Quindi 
\[
  a^b = a^{\sum_{i=0}^k b_i \cdot 2^i} = \prod_{i=0}^k a^{b_i \cdot 2^i}
\]
Con il sistema di numerazione binario possiamo calcolare in maniera efficiente
l'esponenziazione, in un numero di moltiplicazioni pari al numero di bit di $b$.
\begin{algorithmic}[1]
  \Procedure{Iterative Squaring}{$a,b$}
    \State $y \gets 1$
    \State $t \gets a$
    \While{$b \not = 0$}
      \If{$b$ is odd}
        \State $y \gets y \cdot t$
      \EndIf
      \State $b \gets b / 2$
      \State $t \gets t \cdot t$
    \EndWhile
    \State \Return $r$
  \EndProcedure
\end{algorithmic}
Se prendiamo però due numeri a $10$ cifre e li moltiplichiamo, il risultato
sarà un numero nel caso pessimo un numero a $20$ cifre.
Nel caso pessimo nella moltiplicazione iterativa il risultato finale 
sarà un numero a $2^k$ cifre, dove $k$ è il numero di bit di $b$.

Per contrastare tale problema modifico tale algoritmo in questo modo:
\begin{algorithmic}[1]
  \Procedure{Iterative Squaring}{$a,b, n$}
    \State $y \gets 1$
    \State $t \gets a$
    \While{$b \not = 0$}
      \If{$b$ is odd}
        \State $y \gets y \cdot t \pmod n$
      \EndIf
      \State $b \gets b / 2$
      \State $t \gets t \cdot t \pmod n$
    \EndWhile
    \State \Return $r$
  \EndProcedure
\end{algorithmic}
A questo punto non ho più il problema di avere numeri con 
crescita esponenziale del risultato, i risultati parziali rimangono 
sempre nella stessa quantità di bit.
\subsection{Il gruppo $\mathbb{Z}_n^*$ con $n = p \cdot q$}
In questo gruppo è possibile il numero di elementi saranno pari a
\[
  |\mathbb{Z}_n^*| = |\mathbb{Z}_p^*| \cdot |\mathbb{Z}_q^*| = 
  (p-1) \cdot (q-1)
\]
Calcolando quindi gli elementi co-primi con $n$.

Esiste una funzione $\varphi(n)$ che mi fornisce la cardinalità di 
$\mathbb{Z}_n^*$, chiama \textbf{funzione di Eulero}.
\[
  \varphi(n) \stackrel{\Delta}{=} |\mathbb{Z}_n^*|
\]

Sia $x$ un numero casuale minore di $n$:
\[
  \probP[x \in \mathbb{Z}_n^*] = \frac{(p-1)(q-1)}{p\cdot q} =
  \frac{p-1}{p} \cdot \frac{q-1}{q} > \frac{1}{4}
\]
Ma se $p$ e $q$ sono grandi, allora $\probP[x \in \mathbb{Z}_n^*] \approx 1$.

Ma quanti elementi di $\mathbb{Z}_n^*$ sono quadrati?
\[
  \frac{p - 1}{2} \cdot \frac{q - 1}{2} = \frac{\varphi(n)}{4}
\]
Un elemento di $\mathbb{Z}_n^*$ è un elemento di $\mathbb{Z}_p^*$ e 
di $\mathbb{Z}_q^*$, quindi se è un quadrato in $\mathbb{Z}_n^*$ è un
quadrato in $\mathbb{Z}_p^*$ e in $\mathbb{Z}_q^*$.
Quindi:
\begin{itemize}
  \item $\frac{1}{4}$ degli elementi di $\mathbb{Z}_n^*$ sono quadrati in 
  $\mathbb{Z}_p^*$ e in $\mathbb{Z}_q^*$.
  \item $\frac{1}{4}$ degli elementi di $\mathbb{Z}_n^*$ sono quadrati in 
  $\mathbb{Z}_p^*$ e non in $\mathbb{Z}_q^*$.
  \item $\frac{1}{4}$ degli elementi di $\mathbb{Z}_n^*$ non sono quadrati in
  $\mathbb{Z}_p^*$ e sono quadrati in $\mathbb{Z}_q^*$.
  \item $\frac{1}{4}$ degli elementi di $\mathbb{Z}_n^*$ non sono quadrati in
  $\mathbb{Z}_p^*$ e in $\mathbb{Z}_q^*$.
\end{itemize}
Per capire se un numero è un quadrato in $\mathbb{Z}_n^*$  in 
maniera semplice è necessario conoscere la fattorizzazione d $n$.
Basta calcolare il simbolo di Legendre rispetto a $p$ e $q$ e so il
risultato. Se non conosco la fattorizzazione di $n$ non conosciamo 
algoritmi efficienti per stabilire se un numero è un quadrato in
$\mathbb{Z}_n^*$ non disponendo della fattorizzazione di $n$.

Quindi anche la quadraticità di un numero è un problema difficile.

\section{Simbolo di Jacobi}
Il simbolo di Jacobi è una generalizzazione del simbolo di Legendre.
\[
    \left(\frac{a}{n_1 \cdot n_2}\right) = 
    \left(\frac{a}{n_1}\right) \cdot \left(\frac{a}{n_2}\right)
  \]
  \[
    \left(\frac{a_1 \cdot a_2}{n}\right) = 
    \left(\frac{a_1}{n}\right) \cdot \left(\frac{a_2}{n_2}\right)
  \]
  Tale simbolo potrà avere valore $-1$ o $1$.

Ad oggi stabilire se un numero è un quadrato in $\mathbb{Z}_n^*$
quando il simbolo di Jacobi è $1$ è un problema difficile.
Se il simbolo di Jacobi è $-1$ allora il numero non è un quadrato
in $\mathbb{Z}_n^*$ per definizione.

Sia $a$ un elemento di $\mathbb{Z}_n^*$ con $\left(\frac{a}{n} \right) = 1$, 
vorrei ottenere un oggetto con la stessa quadraticità di $a$ 
distribuito uniformemente ad oggetti con la stessa quadraticità di $a$.
\section{Generazione di numeri casuali con la stessa quadraticità di $a$}
Sia $x$ un elemento casuale di $\mathbb{Z}_n^*$, allora:
\[
  x \in_R \mathbb{Z}_n^* \Rightarrow x^2 \cdot a
\]
ha la stessa quadraticità di $a$ e sarà distribuito uniformemente 
ad oggetti con la stessa quadraticità di $a$.

Quadrati diversi vengono mappati con la moltiplicazione di $a$ in quadrati 
diversi e quindi la distribuzione è uniforme.
Perché ho una funzione iniettiva e suriettiva (una biezione), quindi la distribuzione 
del risultato sarà la stessa della sorgente.

In questo modo se non conosciamo la natura casuale degli oggetti possiamo 
generare oggetti con la stessa natura, ma casuali (\textit{con quadraticità}).

\section{Turing riduzione}
\begin{lemma}
  Siano $x$ e $y$ due radici quadrate di uno stesso quadrato di $\mathbb{Z}_n^*$, tali che 
  $x \not \equiv \pm y$. Allora il \texttt{mcd} tra $x + y$ e $n$ è un fattore di $n$.
\end{lemma}
\begin{proof}
  Sia $n=p\cdot q$, visto che $x$ e $y$ sono radici quadrate di uno stesso numero 
  sappiamo che $x^2 \equiv y^2 \mod n$. Quindi:
  \[
    x^2 \equiv y^2 \mod n \Rightarrow x^2 - y^2 \equiv 0 \mod n 
  \]
  \[
    \Rightarrow (x-y)(x+y) = k \cdot n \qquad \text{per qualche $k$}
  \]
  Supponiamo che $p$ divida $x+y$, ma è possibile che $q$ divida $x-y$?
  Se fosse possibile allora $n$ divide $x +y$, ma ciò vorrebbe dire che $x+y \equiv 0 \mod n$,
  ovvero $x \equiv -y \mod n$ e ciò è assurdo perché $x \not \equiv \pm y$.
  Quindi $\texttt{mcd}(x+y, n) = p$.
  
  Supponiamo che $q$ divida $x+y$, ma è possibile che $p$ divida $x-y$?
  Se fosse possibile allora $n$ divide $x +y$, ma ciò vorrebbe dire che $x+y \equiv 0 \mod n$,
  ovvero $x \equiv -y \mod n$ e ciò è assurdo perché $x \not \equiv \pm y$.
  Quindi $\texttt{mcd}(x+y, n) = q$.

  Supponiamo che $p$ non divida $x+y$ e che $q$ non divida $x+y$, ma $p$ e $q$ sono 
  fattori del prodotto $(x-y)(x+y)$, quindi $p$ e $q$ devono essere fattori di almeno 
  uno dei due fattori. Se $p$ non divide $x+y$ allora $q$ deve dividere $x+y$, allora 
  $p$ e $q$ sono fattori di $x-y$, ma allora $x \equiv y \mod n$ e ciò è assurdo.
   
\end{proof}
Se abbiamo due radici quadrate distinte allora riusciamo a trovare la fattorizzazione di $n$. Il 
problema ora è come faccio a trovare due radici distinte di un numero se mi viene fornito l'algoritmo 
per il calcolo della radice quadrata?
Supponiamo che esista un algoritmo $A\in \texttt{PPT}$ (\textit{probabilistic polynomial time})
che calcoli la radice quadrata di un numero in $\mathbb{Z}_n^*$. Allora:
\begin{algorithmic}[1]
  \Procedure{Factorial}{$n$}
    \State $x \in_R \mathbb{Z}_n^*$
    \State $y \gets A(x^2)$
    \State $z \gets \texttt{mcd}(x-y, n)$
    \If{$z \neq n$}
      \Return $z$
    \Else

      \Return \texttt{Factorial}($n$)
    \EndIf
  \EndProcedure
\end{algorithmic}
Prendo un quadrato a caso, di questo quadrato conosco una radice scelta uniformemente 
tra le quattro possibili. L'algoritmo $A$ mi restituisce una radice quadrata di $x^2$,
l'algoritmo sceglierà la radice quadrata in qualche modo, sicuramente indipendente dalla 
scelta fatta su $x$. La probabilità che la radice scelta sia $x$ o l'opposto di $x$ è
$\frac{1}{2}$, quindi il test che verifica se $z$ è un fattore di $n$ avrà successo con
probabilità $\frac{1}{2}$, quindi ripeto l'algoritmo $A$ un numero costante di volte
poiché la probabilità di successo è costante. Quindi l'algoritmo è polinomiale.

Il numero di esperimenti da eseguire per aver successo è data dalla distribuzione geometrica,
e il valore atteso è il reciproco della ragione di successo, quindi in media devo eseguire
due volte l'algoritmo $A$ per avere successo.

Ciò ci porta a dire che calcolare la radice quadrata è verosimilmente difficile, perché 
se qualcuno ci riuscisse allora potremmo fattorizzare in tempo polinomiale.

L'idea di dimostrare la sicurezza di un crittosistema è quella di dimostrare che esista un algoritmo 
che utilizzi come sottoprocedura un algoritmo che risolve un problema difficile.
I problemi difficili sono quelli che non si riescono a risolvere in tempo polinomiale, quindi
il calcolo della radice quadrata, il logaritmo discreto e la fattorizzazione di numeri primi.
